<!DOCTYPE html>
<html>
  <head>
    <title>Australian Tax Calculator</title>

    <!-- Bootstrap core CSS -->
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

    <!-- Custom fonts for this template -->
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href="css/paycalc.css" rel="stylesheet">
  </head>

<body>

<nav class="navbar navbar-toggleable-md bg-green">
  
  Tax Calculator

</nav>

<div class="container bg-lightgreen">
  <h2>Tax Calculator</h2>

<form>
  <h3>Income</h3>
  <div class="row">
    <div class="col-sm-3">
      <div class="form-group">
        <label for="payg_income">PAYG Income</label> 
        <input type="text" id="payg_income" value="0" class="form-control"> 
      </div>
    </div>
    <div class="col-sm-3">
      <div class="form-group">
        <label for="aus_dividends">Australian Dividends</label> 
        <input type="text" id="aus_dividends" value="0" class="form-control"> 
      </div>
    </div>
    <div class="col-sm-3">
      <div class="form-group">
        <label for="other_income">Other Income</label> 
        <input type="text" id="other_income" value="0" class="form-control">
      </div>
    </div>
  </div> 
  <h3>Costs</h3>
  <div class="row">
    
    <div class="col-sm-3">
      <div class="form-group">
        <label for="debt">Deductable Debt</label> 
        <input type="text" id="deductable_debt" value="0" class="form-control">
      </div>
    </div>
    <div class="col-sm-3">
      <div class="form-group">
        <label for="debt">Non-Deductable Debt</label> 
        <input type="text" id="debt" value="0" class="form-control">
      </div>
    </div>

    <div class="col-sm-3">
      <div class="form-group">
        <label for="monthly_rent">Monthly Rent</label>
        <input type="text" id="monthly_rent" value="0" class="form-control">
      </div>
    </div>
    <div class="col-sm-3">
      <div class="form-group">
        <label for="hobbies">Hobby Memberships</label>
        <input type="text" id="hobbies" class="form-control" value="0">
      </div>
    </div>
  </div>
  <div class="row">
    <div class="col-sm-3">
      <div class="form-group">
        <label for="interest_rate">Deductable Rate</label>
        <input type="text" id="deductable_interest_rate" value="0" class="form-control">

      </div>
    </div>
    <div class="col-sm-3">
      <div class="form-group">
        <label for="interest_rate">Loan Rate</label>
        <input type="text" id="interest_rate" value="0" class="form-control">
      </div>
    </div>
    <div class="col-sm-3">
      <div class="form-group">
        <label for="insurances"> Insurances and Rego</label>
        <input type="text" id="insurances" value="0" class="form-control" placeholder="Car/health/property" >
      </div>
    </div>
    <div class="col-sm-3">
      <div class="form-group">
        <label for="telephone"> Phone Bill Monthly</label>
        <input type="text" id="telephone" value="0" class="form-control">
      </div>
    </div>
  </div>
</form>
<hr>
<button class="btn-primary btn btn-primary mt-25px" onclick="updateTax()">Crunch the numbers</button>
<button class="btn-primary btn btn-primary mt-25px" onclick="readFromLocal()">Read</button>
<button class="btn-primary btn btn-primary mt-25px" onclick="saveToLocal()">Save</button>
<button class="btn-primary btn btn-primary mt-25px" onclick="clearLocal()">Clear Local</button>
<hr>
<div class="col-sm-6">
<table class="table">
  <tr> 
    <td>Salary</td><td id="salary"></td><td>Superannuation</td><td id="superannuation"></td>
  </tr>
  <tr> 
    <td>Tax</td><td id="tax"></td><td>Total Dividends</td><td id="total_dividends"></td>
  </tr>
  <tr> 
    <td>Taxible Income</td><td id="taxible_income"></td><td>Company Tax</td><td id="company_tax"></td>
  </tr>
  <tr> 
    <td>Medicare</td><td id="medicare_levy"></td>
  </tr>
</table>
</div>
<hr>
<table class="table">
  <th>
    <td>Before Expenses</td><td>After Expenses</td>
  </th>
  <tr> 
    <td>Gross Income</td><td id="gross_income"></td><td id="post_expenses"></td>
  </tr>
  <tr> 
    <td>Monthly Gross Income</td><td id="monthly_gross_income"></td><td id="post_exp_monthly"></td>
  </tr>
  <tr> 
    <td>Weekly Gross Income</td><td id="weekly_gross_income"></td><td id="post_exp_weekly"></td>
  </tr>
  <tr> 
    <td>Daily Gross Income</td><td id="daily_gross_income"></td><td id="post_exp_daily"></td>
  </tr>

  </table>

</div>


</body>
</html>

<script>

  // Create our number formatter.
  

  function calcInterest(interest_rate, debt) {
    interest_rate * debt * 0.01;
  }

  function updateTax () {

    var payg_income = $("#payg_income").val();
    console.log(payg_income)

    //$("#income").text(income);

    var deductable_interest_rate = $("#deductable_interest_rate").val();
    var deductable_debt = $("#deductable_debt").val();
    console.log("deductable debt " + deductable_debt + 
      " deductable_interest_rate " + deductable_interest_rate);


    var yearly_rent = $("#monthly_rent").val() * 12;
    var deductable_interest = deductable_interest_rate * deductable_debt * 0.01;
    console.log("interest " + deductable_interest);

    var total_dividends = eval($("#aus_dividends").val()) / .7 ;
    console.log("total_dividends " + total_dividends);
    var company_tax = total_dividends * .3;
    console.log("company_tax " + company_tax)
    var other_income = $("#other_income").val();

    // Calcualations
    var taxible_income = eval(payg_income) +
                         eval(other_income) + 
                         eval(total_dividends) -
                         eval(deductable_interest) ;
    var tax = calcTax(taxible_income);
    var medicare_levy = 0.02 * taxible_income;
    var gross_income = taxible_income - tax - medicare_levy - company_tax;
    
    $("#total_dividends").text(total_dividends.toFixed(2));
    $("#company_tax").text(company_tax.toFixed(2));


    // write the values to tables
    $("#salary").text(payg_income);
    $("#superannuation").text(payg_income * 0.095);
    $("#taxible_income").text(eval(taxible_income).toFixed(2));
    $("#tax").text(tax.toFixed(2));

    $("#gross_income").text(gross_income.toFixed(2));
    $("#medicare_levy").text(medicare_levy.toFixed(2));
    $("#monthly_gross_income").text(monthly(gross_income));
    $("#weekly_gross_income").text(weekly(gross_income));
    $("#daily_gross_income").text(daily(gross_income));

    console.log(getYearlyExpenses())
  
    post_expenses_income = gross_income - getYearlyExpenses();
    $("#post_expenses").text(post_expenses_income.toFixed(2));
    $("#medicare_levy").text(medicare_levy.toFixed(2));
    $("#post_exp_monthly").text(monthly(post_expenses_income));
    $("#post_exp_weekly").text(weekly(post_expenses_income));
    $("#post_exp_daily").text(daily(post_expenses_income));

    
  }

  function monthly(yearly) {
    return (yearly/12).toFixed(2)
  }
  function weekly(yearly) {
    return (yearly/365*7).toFixed(2)
  }
  function daily(yearly) {
    return (yearly/365).toFixed(2)
  }

  function getYearlyExpenses() {
    return (
      eval($("#monthly_rent").val() * 12)
      + eval($("#insurances").val())
      + eval($("#telephone").val() * 12)
      + eval($("#hobbies").val())
      + eval($("#debt").val() * $("#interest_rate").val() * 0.01)
    ) 
  }

  function calcTax(income) {
    if (income < 18001) {
      return 0
    }
    if (income < 37001) {
      return 0.19 * (income - 18000)
    }
    if (income < 87001) {
      return 3572 + (0.325 * (income - 37000))
    }
    if (income < 180001) {
      return 19822 + (0.37 * (income - 87000))
    }
    if (income > 180000) {
      return 54232 + (0.45 * (income - 180000))
    }
  }

  function readFromLocal() {
    console.log("reading");
    $("#payg_income").val(localStorage.payg_income);
    $("#aus_dividends").val(localStorage.aus_dividends);
    $("#other_income").val(localStorage.other_income); 

    $("#deductable_interest_rate").val(localStorage.deductable_interest_rate);
    $("#deductable_debt").val(localStorage.deductable_debt);
    $("#interest_rate").val(localStorage.interest_rate);
    $("#debt").val(localStorage.debt);
  
    $("#monthly_rent").val(localStorage.monthly_rent);
    $("#insurances").val(localStorage.insurances);
    $("#telephone").val(localStorage.telephone);
    $("#hobbies").val(localStorage.hobbies);
  }

  function saveToLocal() {

    localStorage.payg_income = $("#payg_income").val();
    localStorage.aus_dividends = $("#aus_dividends").val();
    localStorage.other_income = $("#other_income").val();

    localStorage.deductable_interest_rate = $("#deductable_interest_rate").val();
    localStorage.deductable_debt = $("#deductable_debt").val();
    localStorage.interest_rate = $("#interest_rate").val();
    localStorage.debt = $("#debt").val();

    localStorage.monthly_rent = $("#monthly_rent").val();
    localStorage.insurances = $("#insurances").val();
    localStorage.telephone = $("#telephone").val();
    localStorage.hobbies = $("#hobbies").val();

  }

  function clearLocal() {
    localStorage.clear()
  }

  readFromLocal()
  updateTax()


</script>

